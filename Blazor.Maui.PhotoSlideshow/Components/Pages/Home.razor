@page "/"


<div class="slideshow-container">
    @if (_currentImages.Any())
    {
        <div class="mosaic-grid @(SlideshowService.IsAnimationRunning ? "animated" : "") @(SlideshowService.IsAnimationPaused ? "paused" : "")">
            @foreach (var image in _currentImages)
            {
                @if (!string.IsNullOrEmpty(image.CachedPath) && !image.IsFullScreen)
                {
                    <div class="image-item"
                         style="opacity: @image.Opacity;">
                        @*  mosaïque *@
                        <img src="@GetImageSource(image.CachedPath)" alt="Photo" loading="lazy" />
                    </div>
                }
            }
        </div>

        @* Image plein écran en dehors de la grille *@
        @foreach (var image in _currentImages.Where(img => img.IsFullScreen))
        {
            @if (!string.IsNullOrEmpty(image.FullscreenPath))
            {
                <div class="fullscreen-overlay @(_isFullscreenExiting ? "exiting" : "")" style="opacity: @image.Opacity;">
                    @if (_fullscreenImageBase64 != null)
                    {
                        <img src="@_fullscreenImageBase64" />
                    }
                    else
                    {
                        <div class="loading">Chargement de l'image...</div>
                    }
                </div>
            }
        }
    }
    else
    {
        <div class="loading">
            <p>Scan du réseau en cours...</p>
            <p>L'affichage démarrera dès les premières images trouvées</p>
        </div>
    }
</div>

<div class="controls">
    <button @onclick="ToggleAnimation">@(_isRunning ? "Pause" : "Démarrer")</button>
    <button @onclick="ClearCacheAndReload">Vider le cache</button>
    <button @onclick="ToggleSettings">⚙️ Paramètres</button>
    <div class="status">
        @if (!SlideshowService.IsLoadingComplete)
        {
            <p>Chargement: @SlideshowService.LoadedImages / @SlideshowService.TotalImages</p>
            @if (SlideshowService.TotalImages > 0)
            {
                <progress value="@SlideshowService.LoadedImages" max="@SlideshowService.TotalImages"></progress>
            }
        }
        else
        {
            <p>✓ @SlideshowService.TotalImages images chargées</p>
        }
        @* Afficher les stats du cache *@
        <p style="font-size: 0.8em; opacity: 0.7;">Cache: @_cacheStats.count images (@_cacheStats.pending en cours)</p>
    </div>
</div>

@if (_showSettings)
{
    <div class="settings-panel">
        <h3>Configuration</h3>
        <div class="form-group">
            <label for="networkFolder">Chemin réseau des photos:</label>
            <input type="text" id="networkFolder" @bind="_networkFolderInput" placeholder="\\SERVEUR\dossier\photos" />
        </div>
        <div class="settings-buttons">
            <button @onclick="SaveSettings" class="btn-primary">Enregistrer</button>
            <button @onclick="ToggleSettings" class="btn-secondary">Annuler</button>
        </div>
    </div>
}

